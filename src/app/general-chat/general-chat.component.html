<div class="fixed bottom-12 right-12 z-50">
  <div
    class="absolute bottom-0 right-0 mb-16 bg-gray-900 rounded-xl shadow-2xl w-96 transition-all duration-300 transform"
    [ngClass]="{ 'scale-100 opacity-100 translate-y-0': isOpen, 'scale-90 opacity-0 translate-y-10 pointer-events-none': !isOpen }"
    [ngStyle]="{ height: isOpen ? '450px' : '0' }"
  >
    <!-- Header -->
    <div class="bg-gradient-to-r from-black to-green-600 text-white px-4 py-3 flex justify-between items-center rounded-t-xl h-14">
      <span class="font-sans font-semibold text-base flex items-center">
        <span *ngIf="isLoading" class="mr-2 inline-block h-3 w-3 rounded-full bg-white animate-pulse"></span>
        {{ selectedConversation?.name || 'Chat' }}
      </span>
      <button
        (click)="toggleChat()"
        class="w-10 h-10 flex items-center justify-center rounded-full text-2xl font-bold hover:scale-125 transition-transform"
      >
        Ã—
      </button>
    </div>

    <!-- Message list -->
    <div
      class="p-4 overflow-y-auto flex-grow relative"
      style="height: calc(100% - 112px);"
    >
      <div class="absolute inset-0 bg-[url('https://mcdn.coolmate.me/image/December2023/spotify-la-gi-3320_808.jpg')] bg-cover bg-center opacity-50"></div>
      <div class="relative z-10 h-full">

        <!-- Loading -->
        <div *ngIf="isLoading" class="flex justify-center items-center h-full">
          <div class="flex flex-col items-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-green-500"></div>
            <p class="mt-2 text-gray-300">Loading messages...</p>
          </div>
        </div>

        <!-- Empty -->
        <div *ngIf="!isLoading && messages.length === 0" class="flex justify-center items-center h-full">
          <div class="text-center text-gray-400">
            <p>No messages yet</p>
            <p class="text-sm mt-2">Start your conversation now!</p>
          </div>
        </div>

        <!-- Messages -->
        <div
          *ngFor="let message of messages"
          class="mb-4 flex"
          [ngClass]="{ 'justify-end': message.isUser, 'justify-start': !message.isUser }"
        >
        
          <div
            class="max-w-[75%] px-3 py-2 rounded-xl shadow-sm backdrop-blur-sm"
            [ngClass]="{ 'bg-green-500/90 text-white': message.isUser, 'bg-gray-800/90 text-white': !message.isUser }"
          >
            <div class="flex items-start mb-1">
              <div class="text-sm font-sans whitespace-pre-wrap">{{ message.text }}</div>
            </div>
            <div class="text-xs font-sans text-right text-gray-400">{{ formatTime(message.timestamp) }}</div>
          </div>
        </div>

        <div #messagesEnd></div>
      </div>
    </div>

    <!-- Message input -->
    <form
      (ngSubmit)="handleSubmit($event)"
      class="border-t border-gray-800 p-4 flex items-center bg-gray-900 h-16 rounded-b-xl"
    >
      <input
        #inputField
        type="text"
        [(ngModel)]="inputValue"
        (input)="handleInputChange($event)"
        placeholder="Type a message..."
        class="flex-grow p-2 bg-gray-800 text-white border border-gray-700 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-sm font-sans transition-all"
        [disabled]="isLoading"
        name="messageInput"
        autocomplete="off"
      />
      <button
        type="submit"
        class="bg-gradient-to-br from-green-500 to-green-600 text-white px-4 py-3 rounded-r-lg hover:from-green-600 hover:to-green-700 transition-all text-sm font-sans font-medium"
        [disabled]="isLoading || !inputValue.trim()"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
        </svg>
      </button>
    </form>
  </div>
</div>
